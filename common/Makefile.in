# Vino Crescini <jcrescin@cit.uws.edu.au>

TOPSRCDIR = @top_srcdir@
DISTDIR = @DISTDIR@
CC = @CC@
CXX = @CXX@
LEX = @LEX@
YACC = @YACC@
CFLAGS = @CFLAGS@
CXXFLAGS = @CXXFLAGS@
LN_S = @LN_S@
TARGETS = libcommon.a
INCLUDES = vlad.h list.h stringlist.h numberlist.h
OBJECTS = list.o stringlist.o numberlist.o

all : copy-includes copy-targets

copy-includes : $(INCLUDES)
	@mkdir -p $(DISTDIR)/include/vlad
	@for i in $(INCLUDES); do \
	(cd $(DISTDIR)/include/vlad && $(LN_S) -f ../../../common/$$i $$i); \
	done

copy-targets : $(TARGETS)
	@mkdir -p $(DISTDIR)/lib/vlad
	@for i in $(TARGETS); do \
	(cd $(DISTDIR)/lib/vlad && $(LN_S) -f ../../../common/$$i $$i); \
	done

libcommon.a : $(OBJECTS)
	$(AR) -rcs $(@) $(OBJECTS)

list.o : list.h list.cpp
	$(CXX) $(CXXFLAGS) -o $(@) -c list.cpp

stringlist.o : stringlist.h stringlist.cpp list.o
	$(CXX) $(CXXFLAGS) -o $(@) -c stringlist.cpp

numberlist.o : numberlist.h numberlist.cpp list.o
	$(CXX) $(CXXFLAGS) -o $(@) -c numberlist.cpp

clean :
	$(RM) $(OBJECTS)

distclean : clean
	$(RM) $(TARGETS) Makefile
	@for i in $(INCLUDES); do \
	$(RM) $(DISTDIR)/include/vlad/$$i; \
	done
	@for i in $(TARGETS); do \
	$(RM) $(DISTDIR)/lib/vlad/$$i; \
	done
