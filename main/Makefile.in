# Vino Crescini <jcrescin@cit.uws.edu.au>

TOPSRCDIR = @top_srcdir@
CC = @CC@
CXX = @CXX@
LEX = @LEX@
YACC = @YACC@
LEXLIB = @LEXLIB@
DEBUG = @enable_debug@
CFLAGS = -ansi                  \
         -Wall                  \
         -Wstrict-prototypes    \
         -I$(TOPSRCDIR)/include \
         -L$(TOPSRCDIR)/lib     \
         $(NULL)
LDFLAGS = -L$(TOPSRCDIR)/lib
TARGETS = vlad

ifeq "$(DEBUG)" "yes"
CFLAGS += -g -DDEBUG
else
CFLAGS += -O2
endif

CXXFLAGS = $(CFLAGS)

all : $(TARGETS)

vlad : vlad.o $(TOPSRCDIR)/lib/*
	$(CXX) $(LDFLAGS) -o $(@) vlad.o -lparser -lkb -lcommon $(LEXLIB)
	@for i in $(TARGETS); do      \
	ln -sf main/$$i $(TOPSRCDIR); \
	done
ifneq "$(DEBUG)" "yes"
	strip $(@)
endif

vlad.o : vlad.cpp
	$(CXX) $(CXXFLAGS) -o $(@) -c vlad.cpp

clean :
	$(RM) *.o

distclean : clean
	$(RM) $(TARGETS) Makefile
	@for i in $(TARGETS); do \
	$(RM) $(TOPSRCDIR)/$$i;  \
	done
