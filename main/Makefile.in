# Vino Fernando Crescini <jcrescin@cit.uws.edu.au>

TOPSRCDIR = @top_srcdir@
DISTDIR = @DISTDIR@
CURDIR = main
CC = @CC@
CXX = @CXX@
LEX = @LEX@
YACC = @YACC@
CFLAGS = @CFLAGS@
CXXFLAGS = @CXXFLAGS@
LDFLAGS = @LDFLAGS@
LN_S = @LN_S@
DEBUG = @DEBUG@
STRIP = @STRIP@
BUILDSHARED = @BUILDSHARED@
SMODELS = @SMODELS@
WRAPPER = @WRAPPER@
STATIC = @STATIC@
VERSION = @VERSION@
BINS = vlad
STATIC_LIBS =
SHARED_LIBS =
INCLUDES =
OBJECTS = \
  vlad.o \
  policy_parser.o \
  policy_scanner.o \
  agent_parser.o \
  agent_scanner.o \
  $(NULL)

TEMPS1 = \
  lex.*.cpp \
  *.tab.cpp \
  *.tab.h \
  $(NULL)
TEMPS2 =

ifdef SMODELS
SMLIBS = -lsmodels
endif

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
includedir = @includedir@

include $(TOPSRCDIR)/rules.mk

vlad : $(OBJECTS)
ifdef STATIC
	$(CXX) $(LDFLAGS) -static -o $(@) $(OBJECTS) -lvlad $(SMLIBS)
else
	$(CXX) $(LDFLAGS) -o $(@) $(OBJECTS) -lvlad $(SMLIBS)
endif
ifndef DEBUG
  ifdef STRIP
	strip $(@)
  endif
endif

vlad.o : parser.h vlad.cpp
	$(CXX) $(CXXFLAGS) -o $(@) -c vlad.cpp

agent_scanner.o : agent.tab.h lex.agent.cpp
	$(CXX) $(CXXFLAGS) -o $(@) -c lex.agent.cpp

agent_parser.o : agent.tab.h agent.tab.cpp
	$(CXX) $(CXXFLAGS) -o $(@) -c agent.tab.cpp

policy_scanner.o : policy.tab.h lex.policy.cpp
	$(CXX) $(CXXFLAGS) -o $(@) -c lex.policy.cpp

policy_parser.o : policy.tab.h policy.tab.cpp
	$(CXX) $(CXXFLAGS) -o $(@) -c policy.tab.cpp

lex.agent.cpp : agent.l
	$(LEX) -Pagent agent.l && mv -f lex.agent.c $(@)

lex.policy.cpp : policy.l
	$(LEX) -Ppolicy policy.l && mv -f lex.policy.c $(@)

agent.tab.cpp : agent.y
	$(YACC) -b agent -p agent agent.y && mv -f agent.tab.c $(@)

agent.tab.h : agent.y
	$(YACC) -b agent -p agent -d agent.y

policy.tab.cpp : policy.y
	$(YACC) -b policy -p policy policy.y && mv -f policy.tab.c $(@)

policy.tab.h : policy.y
	$(YACC) -b policy -p policy -d policy.y
