# Vino Crescini <jcrescin@cit.uws.edu.au>

TOPSRCDIR = @top_srcdir@
CC = @CC@
CXX = @CXX@
LEX = @LEX@
YACC = @YACC@
CFLAGS = @CFLAGS@
CXXFLAGS = @CXXFLAGS@
TARGETS = libkb.a
INCLUDES = atom.h expression.h sequence.h symtab.h consttab.h transtab.h kb.h

all : public

public : $(TARGETS)
	@mkdir -p $(TOPSRCDIR)/include
	@mkdir -p $(TOPSRCDIR)/lib
	@for i in $(INCLUDES); do              \
	ln -sf ../kb/$$i $(TOPSRCDIR)/include; \
	done
	@for i in $(TARGETS); do           \
	ln -sf ../kb/$$i $(TOPSRCDIR)/lib; \
	done

libkb.a : atom.o expression.o sequence.o symtab.o consttab.o transtab.o kb.o
	$(AR) -rcs $(@) atom.o expression.o sequence.o symtab.o consttab.o transtab.o kb.o

atom.o : atom.h atom.cpp
	$(CXX) $(CXXFLAGS) -o $(@) -c atom.cpp

expression.o : atom.o expression.h expression.cpp
	$(CXX) $(CXXFLAGS) -o $(@) -c expression.cpp

sequence.o : sequence.h sequence.cpp
	$(CXX) $(CXXFLAGS) -o $(@) -c sequence.cpp

symtab.o : symtab.h symtab.cpp
	$(CXX) $(CXXFLAGS) -o $(@) -c symtab.cpp

consttab.o : expression.o consttab.h consttab.cpp
	$(CXX) $(CXXFLAGS) -o $(@) -c consttab.cpp

transtab.o : expression.o transtab.h transtab.cpp
	$(CXX) $(CXXFLAGS) -o $(@) -c transtab.cpp

kb.o : expression.o symtab.o consttab.o transtab.o kb.h kb.cpp
	$(CXX) $(CXXFLAGS) -o $(@) -c kb.cpp

clean :
	$(RM) *.o

distclean : clean
	$(RM) $(TARGETS) Makefile
	@for i in $(INCLUDES); do       \
	$(RM) $(TOPSRCDIR)/include/$$i; \
	done
	@for i in $(TARGETS); do    \
	$(RM) $(TOPSRCDIR)/lib/$$i; \
	done
